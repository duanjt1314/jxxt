<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>手机主页面</title>
    <link href="/Content/Script/touch-2.3.1/resources/css/sencha-touch.css" rel="stylesheet"
        type="text/css" />
    <script src="/Content/Script/touch-2.3.1/sencha-touch-all.js" type="text/javascript"></script>
    <script src="/Content/Script/DuanjtJs.js" type="text/javascript"></script>
    <script type="text/javascript">
        /**
        *   JS引用,针对不同模块的加载
        */
        Ext.Loader.setConfig({
            enabled: true,
            paths: {
                'Life': '/Content/PhoneFunction'
            }
        });

        Ext.application({
            launch: function () {
                //日期月份  汉化
                Ext.Date.monthNames = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
                
                Ext.create('Ext.DataView', {
                    fullscreen: true,
                    selectedCls: "dview-selected-item",
                    itemCls: "dview-item",
                    style: "padding:50px;",
                    store: Ext.create("Ext.data.Store", {
                        fields: ['ModuleId', 'ModuleName', "ModuleUrl", "IconUrl", "Notes"],
                        proxy: {
                            type: "ajax",
                            url: "/Module/SelectPhoneModule",
                            reader: {
                                type: "json"
                            }
                        },
                        autoLoad: true
                    }),
                    itemTpl: '<div><img src="{IconUrl}" height="48px" width="48px"/><div style="font-size:12px">{ModuleName}</div> </div>',
                    items: {
                        xtype: "titlebar",
                        docked: "top",
                        title: "溯汇管理系统"
                    },
                    listeners: {
                        itemtap: function (dataview, index, target, record) {
                            //Ext.Msg.alert("提示", record.get("Notes"));
                            if (!Ext.getCmp(record.get("ModuleId"))) {
                                //Ext.create("Jiang.LifeList", {});
                                //创建 要加载的功能
                                var panel = Ext.create(record.get("Notes"), { id: record.get("ModuleId") }); //
                                //添加功能到 主程序中
                                //Ext.Viewport.add(panel);
                                //切换到 功能页面
                                Ext.Viewport.animateActiveItem(panel, 'slide');
                                //WP7输入bug,不能自动收缩下去,屏蔽输入法
                                Ext.util.InputBlocker.blockInputs();
                            } else {
                                Ext.Viewport.animateActiveItem(Ext.getCmp(record.get("ModuleId")), 'slide');
                            }
                        }
                    }
                });

            }
        });

    </script>
    <style type="text/css">
        .dview-item
        {
            float:left;
            width:75px;
            height:75px;
            text-align:center;
            margin:5px;
        }
        .dview-selected-item img
        {
            width:55px;
            height:55px;
        }
    </style>
</head>
<body>
</body>
</html>
